Questions
-------------

1. So what do I do when I don't want to just invoke endpoints?

Spec.Tutorial.Escrow does not actually export a complete concrete, only contract endpoints, so for the purposes of the test we just define a contract that invokes those endpoints repeatedly:

2. How to write contractInstanceKey for multiple contracts?



How many tokens does each wallet have?
Do we need to check to see if the wallet has the token first in the precondition?
Where do we care about the deadline?

{-
When the contract starts it produces a number of tokens that represent voting rights.
Holders of those tokens can propose changes to the state of the contract and vote on them.
After a certain period of time the voting ends and the proposal is rejected or accepted.
-}


# Governance Contract

Simply instantiates the initial holders of the voting tokens and the required votes. 

-- | The governace contract parameters.
data Params = Params
    { baseTokenName  :: TokenName
    -- ^ The token names that allow voting are generated by adding an increasing number to the base token name. See `mkTokenName`.
    , initialHolders :: [PaymentPubKeyHash]
    -- ^ The public key hashes of the initial holders of the voting tokens.
    , requiredVotes  :: Integer
    -- ^ The number of votes in favor required for a proposal to be accepted.
    }

let tokens = Haskell.zipWith (const (mkTokenName (baseTokenName params))) (initialHolders params) [1..]


# Proposal Contract

All that seems needed to vot on a proposal is a tokenname

---------------------------------------------------------------------------------

Governance Contract

#contract

`@new-law`
Anyone can establish a new law. 

It adds a law to the government state, with a minting policy hash and the status of the law is not voting. `(GovState (toBuiltin bsLaw) mph Nothing)`

It mints tokens for all holders for the law. 

(Any holder can propose a change to the law)

`Remember initial holders come from the params of the governance contract itself`

`@add-vote`
Anyone with the correct tokens can vote on a proposal

#proposalContract

Given 

People with voting rights the governance params, it is possible to make a proposal which contains a new law, token name and a deadline. 

---------------------------------------------------------------------------------------------

After running contract

Each wallet has 1 of their own token e.g. w3 has TestLawToken3

------------------------

New-law mints the tokens for all people 

    initLaw = endpoint @"new-law" $ \bsLaw -> do
        let mph = Scripts.forwardingMintingPolicyHash (typedValidator params)
        void $ SM.runInitialise theClient (GovState (toBuiltin bsLaw) mph Nothing) (Ada.lovelaceValueOf 1)
        let tokens = Haskell.zipWith (const (mkTokenName (baseTokenName params))) (initialHolders params) [1..]
        void $ SM.runStep theClient $ MintTokens tokens

---------------------------------


Notes

# Validator Rules 

1. MintTokens (done by new-law)

In mint tokens the gov state must contain just the minting policy hash with no law and no voting state.

2. ProposeChange

In order to propose a change to the law we there must exist a law, mph and the voting state must be nothing. 

3. AddVote

In order to add a vote to the law there must be a law in a voting state and the transaction must validate within the voting deadline. 

4. FinishVoting

Finish voting seems to happen automatically so don't need to consider this. It is part of the proposal contract. In this case the law is overwritten if ayes>= required vote. 

--------------------------------------------------------

Assumptions. 

Each instance of the governance contrat can contain 1 law. 

Using a proposal updates that law. 

Votes are an assoc map of bools. Since it is an assocmap we can simply insert the tokenName and bool multiple times so users can vote multiple times until deadline.  


----------------------------------

More Questions

Make parts of arbitrary action not arbitrary e.g. tokenname

(just use precondition or use guard)

How to properly use multiple contracts e.g. proposal. 



